{
    "collab_server" : "",
    "contents" : "#' Final calculations, run in parallel using \"foreach\".\n#'\n#' Final calculations, run in parallel using \"foreach\".\n#' @param number.simulations number of total simulations to run\n#' @param population.size size of population in each simulation\n#' @param number.days number of days to run for each individual\n#' @param proportion.secretor.positive proportion of people NoV Sec Pos\n#' @param opts1 options for outer loop to speed up run speed\n#' @param opts2 options for inner loop to speed up run speed\n#' @export parallel.calcs\n\nparallel.calcs <- function (number.simulations,\n                            population.size,\n                            number.days,\n                            proportion.secretor.positive,\n                            opts1,\n                            opts2,\n                            output.name,\n                            ...) {\n\n    results <- data.frame ( foreach::`%dopar%`(\n             foreach::`%:%`(foreach::foreach(j = 1:number.simulations, .combine = acomb,\n                                             .options.mpi=opts1),\n                            foreach::foreach (i = 1:population.size, .combine=rbind,\n                                    .options.mpi=opts2,\n                                    .export = c(\"total.dose.params\", ls(.GlobalEnv)),\n                                    .packages = c(\"zoo\", \"msm\", \"FAdist\"))),\n                            {\n                                 output <- if(rbinom(1,1,proportion.secretor.positive) > 0)\n                                              replicate(number.days,\n                                                        do.call(prob.infection.beta.poisson,\n                                                                beta.poisson.params))\n                                      else rep(0, number.days)\n\n                               output2 <- data.frame(khf(output))\n                            }\n             )\n             )\n             ## save outputs for subsequent analyses if required\n             saveRDS(results, file = paste(\"./outputs/\", output.name ,\"_\",\n                population.size, \"_\", number.simulations, \"_\", format(Sys.time(), \"%d_%m_%Y\"),\n                 \".rds\", sep=\"\"))\n}\n\n",
    "created" : 1504533138131.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1108910801",
    "id" : "F5B87760",
    "lastKnownWriteTime" : 1504535608,
    "last_content_update" : 1504535608921,
    "path" : "~/research/ra1188uea/NOVAS/QMRA_Final/qmradoparr/R/parallel.calcs.R",
    "project_path" : "R/parallel.calcs.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}